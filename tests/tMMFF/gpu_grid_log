python run_test_GridFF_ocl_new.py 
Selected device: NVIDIA GeForce RTX 3060
Device Name: NVIDIA GeForce RTX 3060
Max Compute Units: 28
Max Work Group Size: 1024
Global Memory Size: 12044.4375 MB
Local Memory Size: 48.0 KB
Max Clock Frequency: 1777 MHz
/usr/lib/python3/dist-packages/pyopencl/characterize/__init__.py:152: CLCharacterizationWarning: wildly guessing local memory bank count on '<pyopencl.Device 'NVIDIA GeForce RTX 3060' on 'NVIDIA CUDA' at 0x55857fe89950>'
  warn("wildly guessing local memory bank count on '%s'"
Local Memory Access Granularity: 4 bytes
Number of Local Memory Banks: 32
Usable Local Memory Size: 49152 bytes
Fast Math Options: ['-cl-mad-enable', '-cl-fast-relaxed-math', '-cl-no-signed-zeros', '-cl-strict-aliasing']
SIMD Group Size: 32
Double Precision Support: False
 local_memory_per_workgroup() size= 64  __local []   3072.0  float32 
py======= test_gridFF_ocl() START
bSymetrize  False
Qtot  0.0  Qabs  1.4
Atoms: [[2. 2. 0.]
 [0. 0. 0.]]
Debug :: REQs = [[ 2.0175      0.10900351 -0.7         0.        ]
 [ 1.4915      0.03606831  0.7         0.        ]]
New_Atoms: [[2. 2. 0.]
 [0. 0. 0.]]
test_gridFF_ocl() z0=  0.0
next_nice: for raw value 40 -> adjusted to 40
next_nice: for raw value 40 -> adjusted to 40
next_nice: for raw value 200 -> adjusted to 200
!!!! Starting Coulomb potential calculation...
GridFF_cl::makeCoulombEwald_slab()  Lz_slab 20.0, dipol 0.0 niter 2 bDipoleCoorectio False bReturn True bTranspose True bSaveQgrid True bCheckVinTrue bCheckPoisson False 
nz_slab 200.0  ns[2]  200
next_nice: for raw value 400 -> adjusted to 400
ns_cl [ 40  40 400   0]
try_make_buffs na= 2  nxyz= <module 'numpy' from '/home/indranil/.local/lib/python3.10/site-packages/numpy/__init__.py'>  nxyz*bytePerFloat= 2560000
try_make_buff( atoms_buff ) reallocate to [bytes]:  32
try_make_buff( Qgrid_buff ) reallocate to [bytes]:  5120000
try_make_buff( Vgrid_buff ) reallocate to [bytes]:  5120000
GridFF_cl::makeCoulombEwald_slab()._project_atoms_on_grid_quintic_pbc
Debug Project Atoms on Grid Quintic PBC [-2.000000, -2.000000, 0.000000, 0.000000]
Qgrid min,max  -0.11646251 0.11646251
try_make_buffs na= 0  nxyz= <module 'numpy' from '/home/indranil/.local/lib/python3.10/site-packages/numpy/__init__.py'>  nxyz*bytePerFloat= 2560000
GridFF_cl::prepare_poisson() sh= [400  40  40]
FFT is about to be created with grid shape: (400, 40, 40)
GridFF_cl::laplace_real_loop_inert() 
try_make_buffs na= 0  nxyz= <module 'numpy' from '/home/indranil/.local/lib/python3.10/site-packages/numpy/__init__.py'>  nxyz*bytePerFloat= 2560000
try_make_buff( V1_buff ) reallocate to [bytes]:  2560000
try_make_buff( V2_buff ) reallocate to [bytes]:  2560000
try_make_buff( vV_buff ) reallocate to [bytes]:  2560000

Debug before slabPotential:
V_Coul_buff does not exist yet
dz, Lz, dL_slab, Lz_slab, Vol, dVcor, Vcor0 ,g0 ,g0 0.1 20.0 20.0 40.0 640.0000000000001 0.0 -0.0 [-2. -2.  0.  0.] (-2.0, -2.0, 0.0)
try_make_buffs na= 0  nxyz= <module 'numpy' from '/home/indranil/.local/lib/python3.10/site-packages/numpy/__init__.py'>  nxyz*bytePerFloat= 1280000
try_make_buff( V_Coul_buff ) reallocate to [bytes]:  1280000
next_nice: for raw value 400 -> adjusted to 400
Buffer dimensions: [40, 40, 200]
Kernel parameters: ns_cl=[ 40  40 200 200]
!!!!!! slabPotential()  bTranspose   True
GridFF_cl::slabPotential() Transpose => slabPotential_zyx
DEBUG Dimensions:
GPU slabPotential_zyx() ng(40,40,200,200) ixyz(0,0,51|1)) dz=0.1 dVcor=0 Vcor0=-0  
   Grid: ng=(40,40,200,200), nz_=400
  Index j range: 0 to 639999
After GPU slabPotential_zyx() ng(40,40,200) dz=0.1 dVcor=0 Vcor0=-0  
   Index i range: 0 to 320199
  j calculation: (ng[0]-ix-1) + ng.x*(ng[1]-iy-1) + ng.x*ng.y*(nz_-iz-1)
  i calculation: iz + ng.z*(iy + ng.y*ix)
Kernel dimensions: ng=(40,40,200,200)
Total buffer size: 320000
Index ranges:
  ix: 0 to 39
  iy: 0 to 39
  iz: 0 to 199
V_Coul_buff state in slabPotential: range [-55.474, 55.474]

Debug V_Coul_buff before final copy:
Shape: (40, 40, 200)
Range: -55.474 to 55.474

Debug V_Coul_buff after final copy:
Shape: (40, 40, 200)
Range: -55.474 to 55.474
Verification buffer shape: (40, 40, 200)
Verification buffer range: [-55.474, 55.474]
Vin min,max  -62.692448 62.692448
V_Coul_buff: shape=(40, 40, 200), range=[-55.474, 55.474]
GridFF_cl::fit3D() dt=0.5, damp=0.05 nmaxiter=1000 Ftol1e-16
try_make_buffs na= 0  nxyz= <module 'numpy' from '/home/indranil/.local/lib/python3.10/site-packages/numpy/__init__.py'>  nxyz*bytePerFloat= 1280000
try_make_buff( Gs_buff ) reallocate to [bytes]:  1280000
try_make_buff( fGs_buff ) reallocate to [bytes]:  1280000
try_make_buff( dGs_buff ) reallocate to [bytes]:  1280000
try_make_buff( vGs_buff ) reallocate to [bytes]:  1280000
GridFF_cl::fit3D() time[s]  0.32887169113382697   preparation[s]   0.0001963237300515175 [s] nGOPs:  0.32  speed[GOPs/s]:  0.9730238528489921  nstep, nxyz  1000 320000
GridFF_cl::fit3D() DONE Gs_buff.min,max:  -81.06157 81.06156
Starting Morse potential calculation...
autoPBC(nPBC_mors):  (6, 6, 0)
next_nice: for raw value 40 -> adjusted to 40
next_nice: for raw value 40 -> adjusted to 40
next_nice: for raw value 200 -> adjusted to 200
try_make_buffs na= 2  nxyz= <module 'numpy' from '/home/indranil/.local/lib/python3.10/site-packages/numpy/__init__.py'>  nxyz*bytePerFloat= 1280000
try_make_buff( REQs_buff ) reallocate to [bytes]:  32
try_make_buff( V_Paul_buff ) reallocate to [bytes]:  1280000
try_make_buff( V_Lond_buff ) reallocate to [bytes]:  1280000
GPU nAtoms 2 alphaMorse(1.5) R2damp(0.01) 
GridFF_cl::make_MorseFF() time[s]  0.01657747197896242   preparation[s]   0.0002469629980623722 [s] nGOPs:  0.10816  speed[GOPs/s]:  6.52451713610254  na,nxyz,npbc  2 320000 169
GridFF_cl::fit3D() dt=0.5, damp=0.05 nmaxiter=1000 Ftol1e-16
try_make_buffs na= 0  nxyz= <module 'numpy' from '/home/indranil/.local/lib/python3.10/site-packages/numpy/__init__.py'>  nxyz*bytePerFloat= 1280000
GridFF_cl::fit3D() time[s]  0.2514725341461599   preparation[s]   0.00014178920537233353 [s] nGOPs:  0.32  speed[GOPs/s]:  1.2725047730819417  nstep, nxyz  1000 320000
GridFF_cl::fit3D() DONE Gs_buff.min,max:  -4.378245e-12 90.179
GridFF_cl::fit3D() dt=0.5, damp=0.05 nmaxiter=1000 Ftol1e-16
try_make_buffs na= 0  nxyz= <module 'numpy' from '/home/indranil/.local/lib/python3.10/site-packages/numpy/__init__.py'>  nxyz*bytePerFloat= 1280000
GridFF_cl::fit3D() time[s]  0.24875677982345223   preparation[s]   0.00012873532250523567 [s] nGOPs:  0.32  speed[GOPs/s]:  1.2863970993156872  nstep, nxyz  1000 320000
GridFF_cl::fit3D() DONE Gs_buff.min,max:  -7.387333 -3.3002175e-12
Paul  min,max =  -4.378245e-12 90.179
Lond  min,max =  -7.387333 -3.3002175e-12
Coul  min,max =  -81.06157 81.06156
CoulB min,max =  -81.06157 81.06156
test_gridFF_ocl() path =  ./data/NaCl_1x1_L1
Final PLQ Coulomb layer stats: -81.06156921386719 81.06156158447266 -4.905981535685556e-10
test_gridFF_ocl() - save Morse to:  ./data/NaCl_1x1_L1/Bspline_PLQd.npy
py======= test_gridFF() DONE
